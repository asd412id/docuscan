# ===========================================
# DocuScan Production Environment Variables
# ===========================================
# Copy this file to .env and customize values
# Usage: docker-compose up -d --build
# ===========================================
#
# SECURITY ARCHITECTURE:
# ---------------------
# Only the frontend (nginx) is exposed to the internet.
# All other services communicate via internal Docker networks:
#
#   [Internet] -> [Frontend:80] -> [Backend] -> [DB/Redis]
#
# Networks:
#   - frontend-network: Public facing (frontend only)
#   - backend-network: Frontend <-> Backend (internal)
#   - data-network: Backend/Celery <-> DB/Redis (internal)
#   - monitoring-network: Flower <-> Redis (internal)
#
# ===========================================

# -------------------------------------------
# Application Settings
# -------------------------------------------
APP_NAME=DocuScan
APP_VERSION=1.0.0
DEBUG=false

# -------------------------------------------
# Security (REQUIRED - Change in production!)
# -------------------------------------------
# Generate with: openssl rand -hex 32
SECRET_KEY=your-super-secret-key-change-this-in-production

# JWT Token Settings
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# -------------------------------------------
# CORS Settings
# -------------------------------------------
# Comma-separated list of allowed origins
ALLOWED_ORIGINS=http://localhost,http://localhost:3000,https://yourdomain.com

# -------------------------------------------
# PostgreSQL Database (Internal Only)
# -------------------------------------------
# NOTE: Database is NOT exposed externally for security
# Access via: docker exec -it docuscan-db-1 psql -U docuscan
POSTGRES_VERSION=16
POSTGRES_USER=docuscan
POSTGRES_PASSWORD=your-secure-db-password
POSTGRES_DB=docuscan

# Resource limits
POSTGRES_MEMORY_LIMIT=512M
POSTGRES_CPU_LIMIT=1

# -------------------------------------------
# Redis Cache & Message Broker (Internal Only)
# -------------------------------------------
# NOTE: Redis is NOT exposed externally for security
# Access via: docker exec -it docuscan-redis-1 redis-cli
REDIS_VERSION=7
REDIS_PASSWORD=your-secure-redis-password
REDIS_MAXMEMORY=256mb
REDIS_MAXMEMORY_POLICY=allkeys-lru
REDIS_ENABLED=true

# Resource limits
REDIS_MEMORY_LIMIT=512M
REDIS_CPU_LIMIT=0.5

# -------------------------------------------
# Backend API Settings (Internal Only)
# -------------------------------------------
# NOTE: Backend is NOT exposed externally
# All API requests go through frontend nginx proxy

# Uvicorn workers (recommended: 2 * CPU cores + 1)
UVICORN_WORKERS=2

# Resource limits
BACKEND_MEMORY_LIMIT=1G
BACKEND_CPU_LIMIT=2

# -------------------------------------------
# Celery Background Processing (Internal Only)
# -------------------------------------------
CELERY_ENABLED=true
CELERY_CONCURRENCY=2
CELERY_LOG_LEVEL=info

# Resource limits
CELERY_MEMORY_LIMIT=1G
CELERY_CPU_LIMIT=2

# Celery Beat (scheduler) - enable with: --profile scheduler
CELERY_BEAT_MEMORY_LIMIT=256M
CELERY_BEAT_CPU_LIMIT=0.25

# -------------------------------------------
# Celery Flower Monitoring (Optional)
# -------------------------------------------
# Enable with: docker-compose --profile monitoring up -d
#
# SECURITY: Flower binds to localhost only by default.
# Access via SSH tunnel: ssh -L 5555:localhost:5555 your-server
# To expose externally (NOT recommended), set FLOWER_BIND=0.0.0.0
FLOWER_USER=admin
FLOWER_PASSWORD=your-secure-flower-password
FLOWER_PORT=5555
FLOWER_BIND=127.0.0.1
FLOWER_URL_PREFIX=
FLOWER_MEMORY_LIMIT=256M
FLOWER_CPU_LIMIT=0.5

# -------------------------------------------
# Rate Limiting
# -------------------------------------------
RATE_LIMIT_ENABLED=true
RATE_LIMIT_DEFAULT=100/minute
RATE_LIMIT_AUTH=10/minute
RATE_LIMIT_UPLOAD=20/minute
RATE_LIMIT_PROCESS=30/minute

# -------------------------------------------
# File Storage & Upload
# -------------------------------------------
MAX_UPLOAD_SIZE_MB=20
FILE_RETENTION_MINUTES=60

# -------------------------------------------
# OCR Settings (Tesseract)
# -------------------------------------------
# Space-separated language codes
# Available: eng, ind, deu, fra, spa, jpn, kor, chi_sim, chi_tra, ara, etc.
# Install more: add language codes here, rebuild image
TESSERACT_LANGUAGES=eng ind

# -------------------------------------------
# Frontend Settings (ONLY EXPOSED SERVICE)
# -------------------------------------------
# This is the only port exposed to the internet
FRONTEND_PORT=80

# Build-time API URL (optional, leave empty for same-origin)
# Use for external API or different domain
VITE_API_URL=

# Resource limits
FRONTEND_MEMORY_LIMIT=256M
FRONTEND_CPU_LIMIT=0.5

# -------------------------------------------
# Deployment Commands
# -------------------------------------------
# Standard deployment:
#   docker-compose up -d --build
#
# With Celery Beat scheduler:
#   docker-compose --profile scheduler up -d --build
#
# With Flower monitoring:
#   docker-compose --profile monitoring up -d --build
#
# With both:
#   docker-compose --profile scheduler --profile monitoring up -d --build
#
# View logs:
#   docker-compose logs -f [service_name]
#
# Access internal services for debugging:
#   Database: docker exec -it docuscan-db-1 psql -U docuscan
#   Redis: docker exec -it docuscan-redis-1 redis-cli
#   Backend shell: docker exec -it docuscan-backend-1 /bin/bash
